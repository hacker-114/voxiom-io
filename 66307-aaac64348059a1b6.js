try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="c5f95e2e-3047-4c33-adfb-4aa4fbdd6494",e._sentryDebugIdIdentifier="sentry-dbid-c5f95e2e-3047-4c33-adfb-4aa4fbdd6494")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:crazygames-portal":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[66307],{15327:(e,r,t)=>{t.d(r,{A:()=>i});var n,s=t(96540),a=t(21529),o=t(67558),l=t(53951);let u=(n||(n=t.t(s,2))).useSyncExternalStore;function i(e,r={}){let t=(0,l.A)(),n="undefined"!=typeof window&&void 0!==window.matchMedia,{defaultMatches:c=!1,matchMedia:d=n?window.matchMedia:null,ssrMatchMedia:f=null,noSsr:m=!1}=(0,o.A)({name:"MuiUseMediaQuery",props:r,theme:t}),p="function"==typeof e?e(t):e;return(void 0!==u?function(e,r,t,n,a){let o=s.useCallback(()=>r,[r]),l=s.useMemo(()=>{if(a&&t)return()=>t(e).matches;if(null!==n){let{matches:r}=n(e);return()=>r}return o},[o,e,n,a,t]),[i,c]=s.useMemo(()=>{if(null===t)return[o,()=>()=>{}];let r=t(e);return[()=>r.matches,e=>(r.addListener(e),()=>{r.removeListener(e)})]},[o,t,e]);return u(c,i,l)}:function(e,r,t,n,o){let[l,u]=s.useState(()=>o&&t?t(e).matches:n?n(e).matches:r);return(0,a.A)(()=>{let r=!0;if(!t)return;let n=t(e),s=()=>{r&&u(n.matches)};return s(),n.addListener(s),()=>{r=!1,n.removeListener(s)}},[e,t]),l})(p=p.replace(/^@media( ?)/m,""),c,d,f,m)}},21529:(e,r,t)=>{t.d(r,{A:()=>s});var n=t(96540);let s="undefined"!=typeof window?n.useLayoutEffect:n.useEffect},53164:(e,r,t)=>{t.d(r,{R:()=>o});var n=t(96540),s=t(341),a=t(9020);let o=e=>{let{game:r}=e,{setPlayingGame:t,setIsPlaying:o,resetGameInvites:l,setGameInviteLink:u}=n.useContext(a.Tz),i=n.useRef(!1);return n.useEffect(()=>{if(!r)return;t(r);let e=e=>{e.data&&e.data.type===s.x&&("gameLoaded"!==e.data.event||i.current||(i.current=!0,o(!0)))};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e),t(null),o(!1),u(null),l(),i.current=!1}},[r,l,u,o,t]),null}},68044:(e,r,t)=>{t.d(r,{u:()=>n,y:()=>s});let n="game-iframe";function s(){return document.getElementById(n)}},38037:(e,r,t)=>{t.d(r,{A:()=>o});var n=t(74848),s=t(96540),a=t(64996);let o=function(e){return r=>{let{services:t}=s.useContext(a.A);return(0,n.jsx)(e,{services:t,...r})}}},71197:(e,r,t)=>{t.d(r,{A:()=>m});var n=t(96540),s=t(95420),a=t(18081),o=t(341),l=t(12896),u=t(59386),i=t(8056),c=t(40499),d=t(22672);async function f(e){let r=await fetch(e,{method:"GET"});return await r.text()}let m=e=>{let{gameId:r,gameTechnology:t}=e,{user:m}=n.useContext(u.R),p=n.useContext(i.A),[h]=(0,s.n)(d.P),[y]=(0,s.n)(d.kL),[g,w]=(0,a._)(d.IJ,{fetchPolicy:"network-only"}),v=n.useRef([]);return n.useEffect(()=>{if(!w.called||w.loading)return;let e=w.data?.gameData;w.error?(v.current.forEach(e=>{e({type:"requestGameDataNone"})}),v.current=[]):e&&e.dataUrl?f(e.dataUrl).then(r=>{let t={...e,data:r};v.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:t,error:w.error}})}),v.current=[]}):(v.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:w.error}})}),v.current=[])},[w]),n.useEffect(()=>{let e=e=>{m?(v.current=[r=>{let t=e.source;t&&t.postMessage(r,"*")},...v.current],g({variables:{id:r,technology:t}})):v.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:null}})})},n=e=>{let{store:n,version:s,updatedAtTz:a,playedTime:o}=e.data,l=JSON.stringify(n);h({variables:{input:{data:l,id:r,technology:t,version:s,browser:p.browser?.name||"",playedTime:o,deviceType:(0,c.mO)(p.deviceType),updatedAtTz:a}}})},s=e=>{let{version:n}=e.data;y({variables:{input:{id:r,technology:t,version:n,browser:p.browser?.name||"",deviceType:(0,c.mO)(p.deviceType)}}})},a=r=>{if(r.data&&r.data.type===o.x)switch(r.data.event){case"requestGameData":e(r);break;case"updateGameData":case"replaceGameData":(0,l.isDefined)(m)&&n(r);break;case"clearGameData":(0,l.isDefined)(m)&&s(r);break;default:return}};return window.addEventListener("message",a),function(){window.removeEventListener("message",a)}},[h,g,y,r,t,m,p.browser,p.deviceType]),null}},29467:(e,r,t)=>{t.d(r,{A:()=>c});var n=t(96540),s=t(341),a=t(63522),o=t(59386),l=t(45300),u=t(75782),i=t(59785);let c=e=>{let{gameId:r}=e,{user:t}=n.useContext(o.R),{openedDrawer:c}=n.useContext(i.l9),{drawerOpeningPending:d}=n.useContext(i.Cx),{openDrawer:f}=n.useContext(i.lv),{refetch:m,loading:p}=a.ic(),{refetch:h,loading:y}=a.X6(),[g,w]=(0,n.useState)(!1),[v,k]=(0,n.useState)(null),{user:b}=a.Jd();(0,n.useEffect)(()=>{if(!d&&g&&v&&(t||c||(w(!1),k(null),v.postMessage({type:"showAuthPromptResponse",data:{error:{code:"userCancelled",message:"User cancelled the auth prompt"}}},"*")),t&&b&&!c)){w(!1),k(null);let e={type:"showAuthPromptResponse",data:{user:{id:b.id,username:`${b.username}`,profilePictureUrl:`${l.A.Instance.data.images}${b.profile.avatar}`}}};v.postMessage(e,"*")}},[c,g,t,v,b,d]);let E=(0,n.useCallback)(async(e,n)=>{let s={type:"requestUserTokenResponse",data:{}};if(!t){s.data={error:{code:"userNotAuthenticated",message:"The user is not authenticated"}},e.postMessage(s,"*");return}if(p)return;let a=await m({gameId:r,iframeUrl:n}),o=a.data?.userToken;a.error||!o?(console.error("User token retrieve error",a.error),s.data={error:{code:"unexpectedError",message:"Failed to retrieve user token"}}):s.data={token:o.token,expiresIn:o.expiresIn},e.postMessage(s,"*")},[t,p,m,r]),F=(0,n.useCallback)(async e=>{let n={type:"requestXsollaUserTokenResponse",data:{}};if(!t){n.data={error:{code:"userNotAuthenticated",message:"The user is not authenticated"}},e.postMessage(n,"*");return}if(y)return;let s=await h({gameId:r}),a=s.data?.xsollaUserToken;if(s.error||!a){let e,r;console.error("Xsolla user token retrieve error",s.error),(e=>"object"==typeof e&&null!==e&&"graphQLErrors"in e&&Array.isArray(e.graphQLErrors))(s.error)&&s.error.graphQLErrors.length>0&&(e=s.error.graphQLErrors[0]?.extensions?.code,r=s.error.graphQLErrors[0]?.message),e?n.data={error:{code:e,message:r||""}}:n.data={error:{code:"unexpectedError",message:"Failed to retrieve Xsolla user token"}}}else n.data={token:a.token,expiresIn:a.expiresIn};e.postMessage(n,"*")},[r,h,t,y]);return(0,n.useEffect)(()=>{let e=e=>{let r=()=>{setTimeout(()=>{f("signIn"),w(!0),k(e.source),u.A.removeFakeFullscreenListener(r)},100)};u.A.isFakeFullscreen()?u.A.addFakeFullscreenListener(r):(f("signIn"),w(!0),k(e.source))},r=r=>{if(r.data&&r.data.type===s.x)switch(r.data.event){case"requestUserToken":{let e=r.data;E(r.source,e.iframeUrl);break}case"requestXsollaUserToken":F(r.source);break;case"showAuthPrompt":e(r);break;default:return}};return window.addEventListener("message",r),function(){window.removeEventListener("message",r)}},[r,t,f,F,E]),null}},42293:(e,r,t)=>{t.d(r,{A:()=>o});var n=t(74848),s=t(96540),a=t(30804);let o=function(e){return r=>{let t=s.useContext(a.H);return(0,n.jsx)(e,{experiment:t,...r})}}},75782:(e,r,t)=>{t.d(r,{A:()=>s});class n{removeFullscreenListener(e){this.eventKeys.forEach(r=>{document.removeEventListener(r,e)})}addFullscreenListener(e){this.eventKeys.forEach(r=>{document.addEventListener(r,e)})}addFakeFullscreenListener(e){this.fakeFullscreenListeners.push(e)}removeFakeFullscreenListener(e){this.fakeFullscreenListeners=this.fakeFullscreenListeners.filter(r=>r!==e)}isFullscreen(){let e=window.document;return!!(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement)}isFakeFullscreen(){return this.isInFakeFullscreen}enteredFakeFullscreen(){this.isInFakeFullscreen||(this.isInFakeFullscreen=!0,this.fakeFullscreenListeners.forEach(e=>e()))}exitFakeFullscreen(){this.isInFakeFullscreen&&(this.isInFakeFullscreen=!1,this.fakeFullscreenListeners.forEach(e=>e()))}exitNativeFullscreen(){let e=window.document,r=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;return!!r&&(window.document.fullscreenElement&&r.call(e),!0)}constructor(){this.fakeFullscreenListeners=[],this.eventKeys=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],this.isInFakeFullscreen=!1,this.forceLockOrientation=async(e,r)=>{if(!r||"BOTH"===r||!("screen"in window)||!window.screen||!window.screen.orientation||!window.screen.orientation.lock)return;let t=null;try{await Promise.race([window.screen.orientation.lock("PORTRAIT"===r?"portrait":"landscape"),new Promise((r,n)=>{t=setTimeout(()=>{e.trackGenericError("timeoutError",{message:"Error in orientation lock timeout"}),n(Error("Orientation lock timeout"))},1e3)})])}catch(e){}finally{t&&clearTimeout(t)}}}}let s=new n},62603:(e,r,t)=>{t.d(r,{A:()=>o});var n=t(74848),s=t(96540),a=t(89737);let o=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return e=>class extends s.Component{static async getInitialProps(t){let{trlService:n}=(0,a.V)(t);if(!t.req){let s=Promise.all(r.map(e=>n.loadTrlMessagesToLingui(e))),[a]=await Promise.all([e.getInitialProps?await e.getInitialProps(t):{},s]);return{...a}}let s=Promise.all(r.map(e=>n.getTrlMessages(e))),[o,l]=await Promise.all([e.getInitialProps?e.getInitialProps(t):Promise.resolve({}),s]);return{messages:l.reduce((e,r)=>Object.assign(e,r)),...o}}render(){let{...r}=this.props;return(0,n.jsx)(e,{...r})}}}},18081:(e,r,t)=>{t.d(r,{_:()=>d});var n,s=t(31635),a=t(27243),o=t(60144),l=t(68195),u=t(54269);function i(){}t(67235);var c=["refetch","reobserve","fetchMore","updateQuery","startPolling","stopPolling","subscribeToMore"];function d(e,r){var t,d=a.useRef(void 0),f=a.useRef(void 0),m=a.useRef(void 0),p=(0,o.l)(r,d.current||{}),h=null!==(t=null==p?void 0:p.query)&&void 0!==t?t:e;f.current=r,m.current=h;var y=(0,s.Cl)((0,s.Cl)({},p),{skip:!d.current}),g=(0,l.SX)(h,y),w=g.obsQueryFields,v=g.result,k=g.client,b=g.resultData,E=g.observable,F=g.onQueryExecuted,x=E.options.initialFetchPolicy||(0,l.kk)(y.defaultOptions,k.defaultOptions),C=a.useReducer(function(e){return e+1},0)[1],L=a.useMemo(function(){for(var e={},r=0;r<c.length;r++)!function(r){var t=w[r];e[r]=function(){return d.current||(d.current=Object.create(null),C()),t.apply(this,arguments)}}(c[r]);return e},[C,w]),T=!!d.current,A=a.useMemo(function(){return(0,s.Cl)((0,s.Cl)((0,s.Cl)({},v),L),{called:T})},[v,L,T]),M=(n||(n=a.createContext(null)),a.useCallback(function(){var e=console.error;try{return console.error=i,a.useContext(n),!0}catch(e){return!1}finally{console.error=e}},[]));a.useRef(new Set);var P=a.useCallback(function(e){d.current=e?(0,s.Cl)((0,s.Cl)({},e),{fetchPolicy:e.fetchPolicy||x}):{fetchPolicy:x};var r,t,n,a,u=(0,o.l)(f.current,(0,s.Cl)({query:m.current},d.current)),i=(t=(r=(0,s.Cl)((0,s.Cl)({},u),{skip:!1})).query||h,n=(0,l.Er)(k,t,r,!1)(E),a=E.reobserveAsConcast((0,l.t_)(E,k,r,n)),F(n),new Promise(function(e){var r;a.subscribe({next:function(e){r=e},error:function(){e((0,l.$X)(E.getCurrentResult(),b.previousData,E,k))},complete:function(){e((0,l.$X)(E.maskResult(r),b.previousData,E,k))}})})).then(function(e){return Object.assign(e,L)});return i.catch(function(){}),i},[M,k,h,L,x,E,b,F]),I=a.useRef(P);return(0,u.E)(function(){I.current=P}),[a.useCallback(function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return I.current.apply(I,e)},[]),A]}}}]);
